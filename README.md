# CamPiP

CamPiP — это набор «поверх всех окон» утилит для macOS, упакованный в одно небольшое SwiftUI‑приложение. Он позволяет держать фронтальную камеру, зеркало любого окна и легковесный веб‑оверлей всегда на виду (включая Spaces и полноэкранный режим), что удобно для коллов, стримов, мониторинга графиков и т.д.

## Возможности

- **SelfView** — всплывающее окно с фронтальной камерой. Правильные corner radius, тень и кастомный border помогают держать превью опрятным на всех фонах.
- **Window Mirror** — зеркалирование произвольного окна через ScreenCaptureKit. Если окно пропадает или уезжает на другой Space, CamPiP пытается переподключиться автоматически (по windowID, title и bundleID).
- **Web Overlay** — встраиваемый WKWebView c «клик-сквозь» режимом и автоподстройкой аспект‑рейшио под `<video>` (YouTube, TradingView и т.п.). Для YouTube используется embed‑ссылка с autoplay, чтобы избежать лишних элементов UI.
- Все вспомогательные окна — `NSPanel` уровня `.popUpMenu`, поэтому они плавают поверх системных окон, не мешают Command‑Tab циклу и доступны во всех рабочего пространствах.

## Требования

- macOS 14.0 или новее (ScreenCaptureKit + SwiftUI App lifecycle).
- Xcode 15+ с поддержкой Swift Concurrency.
- Разрешения на доступ к камере и записи экрана.

## Сборка и запуск

1. Клонируйте репозиторий и откройте проект:
   ```bash
   git clone git@github.com:<you>/CamPiP.git
   cd CamPiP
   open CamPiP.xcodeproj
   ```
2. Выберите схему **CamPiP** и запустите приложение на своей машине (`⌘R`). Приложение не требует сторонних зависимостей.

## Использование

1. **Камера**
   - Нажмите «Start camera»; система запросит доступ к камере (один раз).
   - Перетаскивайте окно за любую точку и меняйте размер — превью автоматически обрезается под окно.
   - «Stop camera» освобождает ресурсы и закрывает окно.
2. **Зеркало окна**
   - Нажмите «Pick window & start» и в течение ~3 секунд щёлкните по нужному окну.
   - Если источник пропадает, CamPiP пытается заново привязаться к ближайшему окну того же приложения.
   - «Stop mirroring» отключает поток и чистит `SCStream`.
3. **Web Overlay**
   - Вставьте URL (YouTube, TradingView или любой HTTPS ресурс) и нажмите «Open overlay».
   - Тумблер «клик-сквозь» (`ignoresMouseEvents`) позволяет делать окно полностью прозрачным для мыши.
   - Кнопки Demo заполняют ссылки примерами.

В нижней части основного окна отображается напоминание, что все оверлеи работают поверх всех окон и в полноэкранных Spaces. При закрытии CamPiP автоматически останавливает все сессии и чисто завершает работу.

## Мотивация и планы

Изначально утилита писалась как «швейцарский нож» для созвонов и мониторинга: хотим держать камеру, конкретный трейдинг‑терминал или YouTube‑ролик в режиме «картинка в картинке», но без ограничений системного PiP. В дальнейшем можно добавить:

- сохранение состояний/позиций окон между запусками;
- горячие клавиши для быстрого показа/скрытия оверлеев;
- пресеты ссылок и источников.

Issues и пожелания приветствуются.

## Лицензия

Проект распространяется по лицензии [MIT](LICENSE).
